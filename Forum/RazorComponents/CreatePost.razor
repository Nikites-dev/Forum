@using Forum.Services
@using Forum.MongoDB
@inject PostService postService

<div class="cardCreate">
    <div class="types">
        <button>Post</button>
        <button>Image</button>
        <button>Link</button>
    </div>
    
    <div class="box">
        <div class="tools">
            <button>Bold</button> 
            <button>Cursive</button> 
            <button>Heading</button> 
            <button>Link</button> 
        </div>
        <div class="inputField">
            <label class="control-label">Message</label>
            <textarea rows="4" value="@EmailMessage" @onchange="@((args) => EmailMessage = args.Value.ToString())"></textarea>
        </div>
    </div>
    
    <div class="bottom">
        <button @onclick="@CreateNewPost">Create</button>
    </div>
</div>

@code {

    List<Comment> comments = new()
    {
        new Comment{UserId = 1, Rating = 12, Text = "Cool"},
        new Comment{UserId = 13, Rating = 22, Text = "Text"},
        new Comment{UserId = 134, Rating = 142, Text = "Cool"},
        new Comment{UserId = 11, Rating = 42, Text = "Cool"},
    };
    
    void CreateNewPost()
    {
        Post post = new Post();
        post.Username = "user" + RandomGeneratorId.GetRndNumber();
        post.Comments = comments;
        post.Rating = 234;
        post.Text = emailMessage.ToString();
        post.CreatePost = DateTime.Now;
        post.Likes = new List<int>() { 21, 432, 43, 45 };

        postService.AddPost(post);
        
        PostDbConnection.AddToDatabase(post);

        StateHasChanged();
    }
    
    private string emailMessage = "";
    
    public string EmailMessage
    {
        get =>  emailMessage;
        set
        {
            if (emailMessage != value)
            {
                emailMessage = ((MarkupString)value).ToString();
            }
        }
    }
}